<html>
<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body onLoad="ready()">
    <script type="text/javascript">
        var dataEV = [
            ['Country', 'EV Percentage Penetration', 'Total EV'],
        ]
        window.onmessage = function (event) {
            if (event.data && Array.isArray(event.data)) {
                event.data.forEach((d) => {
                    if (d.evPercentage == undefined) {
                        d.evPercentage = 0
                    }
                    if (d.totalEv == undefined) {
                        d.totalEv = 0
                    }
                    dataEV.push([d.country, d.evPercentage, d.totalEv])
                })
                google.charts.setOnLoadCallback(drawRegionsMap(dataEV));
            }
        }
        google.charts.load('current', {
            'packages': ['geochart'],
            // Note: you will need to get a mapsApiKey for your project.
            // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
            'mapsApiKey': 'AIzaSyDD_XAtqB7bcLzuzWR9cJAGHJd0i_i0uBI'
        });
        function drawRegionsMap(dataEV) {
            var data = google.visualization.arrayToDataTable(dataEV);

            var options = {
                sizeAxis: { minValue: 0, maxValue: 100 },
                keepAspectRatio: true,
                legend: 'none',
                tooltip: { isHtml: true }
            };
            var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
            chart.draw(data, options);
        }

        function ready() {
            console.log("Only displays 1 time")
            window.parent.postMessage({ "type": "ready" }, "*");

        }
    </script>
    <div id="regions_div" class="map" style="width: 100%; height: 100%;"></div>
</body>
</html>
<!--HTTPS only...-->