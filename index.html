<!DOCTYPE html>
<html>

<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson@3"></script>

</head>

<body>
  <p>
    Hello!
  </p>
</body>
<div id="myMap"></div>
<script>
  var width = 900;
  var height = 600;


  // create a tooltip
  // var Tooltip = d3.select("#myMap")
  // .append('div')
  // .style("opacity", 0)
  // .attr("class", "tooltip")
  // .style("background-color", "white")
  // .style("border", "solid")
  // .style("border-width", "2px")
  // .style("border-radius", "5px")
  // .style("padding", "5px")


  var tooltip = d3.select("body")
    .append("div")
    .style("opacity", 0)
    .style("position", "absolute")
    .style("z-index", "10")
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function (d) {
    tooltip
      .style("opacity", 1)
    d3.select(this)
      .style("stroke", "black")
      .style("opacity", 1)
  }
  var mousemove = (event, d) => {
    const [x, y] = d3.pointer(event);

    tooltip
      // .style('transform', `translate(${x}, ${y})`);
      .style("left", (x + "px"))
      .style("top", (y + "px"))
    // .style("left", (d3.event.pageX + "px"))
    // .style("top", (d3.event.pageY + "px"))
  }
  var mouseout = function (d) {
    tooltip
      .style("opacity", 0)
    d3.select(this)
      .style("stroke", "#999")
      .style("opacity", 0.8)
  }

  const svg = d3.select('#myMap').append('svg')
    // .attr('width', width)
    // .attr('height', height)
    .style('position', 'absolute')
    .attr("viewBox", [0, 0, width, height]);
    // .style('left', '50%')
    // .style('top', '50%')
    // .style('transform', 'translate(-50%, -50%)')

  // function zoomed(event) {
  //   const { transform } = event;
  //   g.attr("transform", transform);
  //   g.attr("stroke-width", 1 / transform.k);
  //   tooltip.attr("transform", transform);
  //   tooltip.attr("stroke-width", 1 / transform.k);
  // }

  // const zoom = d3.zoom()
  //   .scaleExtent([1, 8])
  //   .on("zoom", zoomed);

  const projection = d3.geoMercator().scale(140)
    .translate([width / 2, height / 1.4]);
  const path = d3.geoPath(projection);


  const g = svg.append('g')

  function zoomed({transform}) {
    g.attr("transform", transform);
  }

  // svg.call(zoom);
  svg.call(d3.zoom()
      .extent([[0, 0], [width, height]])
      .scaleExtent([1, 8])
      .on("zoom", zoomed));

  d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json')
    .then(data => {

      const countries = topojson.feature(data, data.objects.countries);
      var country = g.selectAll('path').data(countries.features).enter()
      country.append('path')
        .attr('class', 'country')
        .attr('d', path)
        .style('fill', '#ccc')
        .style('stroke', '#999')
        .style('opacity', '0.8')
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseout", mouseout)
        .append("title")
      .text((d, i) => `circle ${i}`);


    });



</script>

</html>